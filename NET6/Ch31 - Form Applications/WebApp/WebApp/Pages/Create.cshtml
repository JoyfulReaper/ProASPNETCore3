@page "/pages/create"
@model CreateModel

<div class="m-2">
	<partial name="_ProductEditor" model="@Model.ViewModel" />
</div>

@functions {
	public class CreateModel : EditorPageModel
	{
		public CreateModel(DataContext context) : base(context) { }

		public void OnGet()
		{
			ViewModel = ViewModelFactory.Create(new Product(), Categories, Suppliers);
		}

		public async Task<IActionResult> OnPostAsync([FromForm]Product product)
		{
			if(ModelState.IsValid)
			{
				product.ProductId = default;
				product.Category = default;
				product.Supplier = default;

				_context.Products.Add(product);
				await _context.SaveChangesAsync();
				return RedirectToPage(nameof(Index));
			}
			ViewModel = ViewModelFactory.Create(product, Categories, Suppliers);
			return Page();
		}
	}
}